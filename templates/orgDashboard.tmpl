{{ define "orgDashboard" }}
{{ template "part_header" . }}

<style type="text/css">
	#dashboard td{
		text-align: center;
	}
	#dashboard td {
		opacity: 0.5;
	}
	#dashboard td.success {
		border: 2px solid green;
		opacity: 1;
	}

	#roundNumber, #teamName {
		text-align: center;
		font-style: italic;
		color: #777777;
		margin-top: -5px;
		margin-bottom: 5px;
	}

	#controls {
		max-width: 400px;
		padding: 10px;
		margin: 0px auto;
		border: 1px #dddddd solid;
		border-radius: 5px;
	}
</style>

<a href="teams" style="float: right;"><button class="btn btn-default">Teams</button></a>

<h1 style="text-align: center;">Stav jezera: {{.CurrentState}}</h1>
<div id="roundNumber">Kolo: {{.RoundNumber}}</div>


<div id="controls">
{{ template "part_messageBox" . }}

<form method="post">
	<input type="submit" class="btn btn-primary btn-block" onclick="return confirm('Ukončit kolo?');" name="calculateRound" value="Ukončit kolo">
</form>
<form method="post" style="margin-top: 4px;">
	<input type="submit" class="btn btn-danger btn-block" onclick="return confirm('Pozot! Toto vymaže všechny kola, pokračovat?');" name="resetGame" value="Resetovat hru">
</form>
<form method="post" style="margin-top: 4px;">
	<input type="submit" class="btn btn-default btn-block" name="sendState" value="Znovuposlat stav vizualizátoru">
</form>
</div>

{{$allActions := .AllActions}}
{{$history := .History}}

<h2>Historie kol</h2>

<table class="table table-bordered" id="history">
<thead>
	<tr><th rowspan='2'>Kolo</th><th rowspan='2'>Stav</th><th colspan="{{len .Teams}}">Peníze a akce</th></tr>
	<tr>{{range .Teams}}<th colspan="2">{{.}}</th>{{end}}</tr>
</thead>
<tbody>
	<tr class="info"><th>NOW</th><td>{{.CurrentState}}</td>
		{{range .CurrentActions}}<td></td><td>{{(index $allActions .).DisplayName}}</td>{{end}}
	</tr>
	{{range .History}}
		<tr><th>{{.RoundNumber}}</th><td>{{.StartState}} -> {{.FinalState}}</td>
			{{range .Teams}}
				<td>{{if .Found}}{{.StartMoney}} -> {{.FinalMoney}}{{end}}</td>
				<td>{{if .Message}}<span title="{{.Message}}" style="border-bottom: 1px dotted;">{{else}}<span>{{end}}{{(index $allActions .Action).DisplayName}}</span></td>
			{{end}}
		</tr>
	{{end}}
</tbody>
</table>

</tbody>
</table>


<script src="/static/js/charts.js" type="text/javascript" charset="utf-8"></script>

<div style="width:75%; margin: 0px auto;">
	<canvas id="canvas"></canvas>
</div>
<script>
	window.chartColors = {
		red: 'rgb(255, 99, 132)',
		orange: 'rgb(255, 159, 64)',
		yellow: 'rgb(255, 205, 86)',
		green: 'rgb(75, 192, 192)',
		blue: 'rgb(54, 162, 235)',
		purple: 'rgb(153, 102, 255)',
		grey: 'rgb(201, 203, 207)'
	};

	var colorNames = Object.keys(window.chartColors);
	var config = {
		type: 'line',
		data: {
			labels: [{{range .History}}'{{.RoundNumber}}',{{end}}].reverse(),
			datasets: [
			{{range $i, $team := .Teams}}
				{
					label: '{{$team}}',
					backgroundColor: window.chartColors[colorNames[{{$i}} % colorNames.length]],
					borderColor: window.chartColors[colorNames[{{$i}} % colorNames.length]],
					data: [{{range $history}}{{(index .Teams $i).FinalMoney}},{{end}}].reverse(),
					fill: false,
				},
			{{end}}
			{
				label: 'JEZERO',
				backgroundColor: window.chartColors.red,
				borderColor: window.chartColors.red,
				data: [{{range $history}}{{.FinalState}},{{end}}].reverse(),
				fill: true,
			}]
		},
		options: {
			responsive: true,
			tooltips: {
				mode: 'index',
				intersect: false,
			},
			hover: {
				mode: 'nearest',
				intersect: true
			},
			scales: {
				xAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'Kolo'
					}
				}],
				yAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'ZEĎcoinů'
					}
				}]
			}
		}
	};

	window.onload = function() {
		var ctx = document.getElementById('canvas').getContext('2d');
		window.myLine = new Chart(ctx, config);
	};
</script>


{{ end }}
